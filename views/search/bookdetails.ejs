<link rel="stylesheet" href="/stylesheets/stars.css">

<div class="row">
    <div class="col-md-4">
        <div class="book-datails sticky-top">
            <img src="<%= book.image %>" class="img-thumbnail" alt="<%= book.title %>">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">
                        <%= book.title%>
                    </h5>
                    <p class="card-text">
                        <%= book.author%>
                    </p>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-muted">
                        <%= book.publisher%>
                    </li>
                    <li class="list-group-item"><a href="<%= book.link %>" target="_blank"
                            class="btn btn-primary mt-3">Buy
                            this book</a>
                    </li>
                    <li class="list-group-item">₩<%= book.price%>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <% if (currentUser) { %>
            <!-- 로그인 상태: 리뷰 작성 창 활성화 -->
            <h2>Leave Your Review</h2>
            <form action="/books/<%=book._id%>/reviews" method="POST" class="mb-3 validated-form" novalidate>
                <fieldset class="rating">
                    <div class="rate">
                        <input id="rate2-star5" type="radio" name="review[rating]" value="5" />
                        <label for="rate2-star5" title="Awesome">5</label>

                        <input id="rate2-star5-half" type="radio" name="review[rating]" value="4.5" />
                        <label class="star-half" for="rate2-star5-half" title="Excellent">4.5</label>

                        <input id="rate2-star4" type="radio" name="review[rating]" value="4" />
                        <label for="rate2-star4" title="Very good">4</label>

                        <input id="rate2-star3-half" type="radio" name="review[rating]" value="3.5" />
                        <label class="star-half" for="rate2-star3-half" title="Good">3.5</label>

                        <input id="rate2-star3" type="radio" name="review[rating]" value="3" />
                        <label for="rate2-star3" title="Satisfactory">3</label>

                        <input id="rate2-star2-half" type="radio" name="review[rating]" value="2.5" />
                        <label class="star-half" for="rate2-star2-half" title="Unsatisfactory">2.5</label>

                        <input id="rate2-star2" type="radio" name="review[rating]" value="2" />
                        <label for="rate2-star2" title="Bad">2</label>

                        <input id="rate2-star1-half" type="radio" name="review[rating]" value="1.5" />
                        <label class="star-half" for="rate2-star1-half" title="Very bad">1.5</label>

                        <input id="rate2-star1" type="radio" name="review[rating]" value="1" />
                        <label for="rate2-star1" title="Awful">1</label>

                        <input id="rate2-star0-half" type="radio" name="review[rating]" value="0.5" />
                        <label class="star-half" for="rate2-star0-half" title="Horrific">0.5</label>
                    </div>
                </fieldset>
                <div class="mb-3">
                    <label class="form-label" for="body">Review Text</label>
                    <textarea class="form-control" name="review[body]" id="body" cols="30" rows="3" required></textarea>
                </div>
                <button class="btn btn-success">Submit</button>
            </form>
            <% } else { %>
                <!-- 로그아웃 상태: 리뷰 작성 창 비활성화 -->
                <h2 class="text-muted">Log in to leave a review</h2>
                <div class="d-flex justify-content-start mb-3">
                    <a href="/login" class="btn btn-primary me-2">Login</a>
                    <a href="/register" class="btn btn-secondary">Register</a>
                </div>
                <fieldset disabled>
                    <form class="validated-form" novalidate>
                        <div class="mb-3">
                            <label class="form-label" for="body">Review Text</label>
                            <textarea class="form-control" id="body" cols="30" rows="3"
                                placeholder="Log in to leave a review" disabled ></textarea>
                        </div>
                        <button class="btn btn-success mb-3" disabled>Submit</button>
                    </form>
                </fieldset>
                <% } %>

                    <div class="mb-3">
                        <button class="btn btn-outline-secondary" data-book-id="<%= book._id %>" 
                            onclick="sortReviews(event, 'likes')">Most Liked</button>
                        <button class="btn btn-outline-secondary" data-book-id="<%= book._id %>" 
                            onclick="sortReviews(event, 'newest')">Newest First</button>
                    </div>

                    <div id="review-section">
                        <%- include('../partials/reviews', { sortedReviews, book, currentUser }) %>
                    </div>
                    
    </div>

</div>


<script src="/javascripts/reviewComment.js"></script>
<script src="/javascripts/sortreview.js"></script>